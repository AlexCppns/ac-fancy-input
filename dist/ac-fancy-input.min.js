/*! ac-fancy-input 03-07-2014 */
!function(){var a=angular.module("ac-fancy-input",[]);a.controller("acfiSuggestionsController",["acfiDataInstance","$scope","$q",function(a,b,c){b.AcfiData=a.get(b.acId),b.$on("onKeyUpAndDown",function(a,c,d){b.acId===d&&b.deferWatching().then(function(d){d&&(b.AcfiData.display=!0,b.AcfiData.onKeyUpAndDown(a,c))})}),b.$on("onCloseDisplay",function(a,c){b.acId===c&&b.$apply(function(){b.AcfiData.display=!1})}),b.deferWatching=function(){var a=c.defer();return b.AcfiData.watching=!1,a.resolve(b.AcfiData.watching===!1),a.promise}}]),a.directive("acFancyInputSuggestions",["$rootScope","$window",function(a,b){var c="<div ng-transclude></div><span acfi-header></span>",d='<div class="type-row clearfix" data-ng-class="suggestion_type.klass" data-ng-class-even="\'even\'" data-ng-class-odd="\'odd\'" data-ng-repeat="suggestion_type in AcfiData.suggestion_types"><div class="type-name-wrapper" data-ng-show="suggestion_type.contents.length > 0"><div class="type-name small semi-bold">{{suggestion_type.name}}</div></div><div class="type-content" data-ng-show="suggestion_type.contents.length > 0"><ul><li data-ng-repeat="content in suggestion_type.contents" data-ng-class="{ selected: content.selected}" data-ng-mouseover="AcfiData.selectSuggestion($parent.$index, $index)" data-ng-click="AcfiData.selectSuggestion($parent.$index, $index); acfiQueryAction()"><div class="row-wrapper light clearfix" acfi-content></div></li></ul></div></div>',e='<div class="view-more"><a data-ng-show="AcfiData.noResultDisplay == false && acSuggestionCount > AcfiData.suggestionDisplayLimit" data-ng-click="acfiViewMoreAction($event)"><div acfi-view-more></div></a><a data-ng-show="AcfiData.noResultDisplay == true" class="no-results"><div acfi-no-results></div></a></div>',f='<div id="input-suggestion-box" class="input-suggestion" data-ng-show="AcfiData.display == true">';return f+=c+d+e,f+="</div>",{scope:{acfiViewMoreAction:"=acViewMoreAction",acSuggestionCount:"=?",acId:"=acId"},template:f,transclude:!0,controller:"acfiSuggestionsController",link:function(c,d,e){void 0===e.acSuggestionCount&&(c.acSuggestionCount=0),c.acfiQueryAction=function(){a.$broadcast("onSubmitQuery",c.acId)};var f=angular.element(b);d.bind("click",function(a){a.stopPropagation()}),f.bind("click",function(){a.$broadcast("onCloseDisplay",c.acId)})}}}]);var b=function(a){return{transclude:!0,restrict:"A",require:"^acFancyInputSuggestions",link:function(b,c,d,e,f){c.remove(),e["renderAcfi"+a+"Template"]=f}}},c=function(a){return{restrict:"A",require:"^acFancyInputSuggestions",link:function(b,c,d,e){void 0!==e["renderAcfi"+a+"Template"]&&e["renderAcfi"+a+"Template"](b,function(a){c.append(a)})}}};a.directive("acfiHeaderTemplate",function(){return b("Header")}),a.directive("acfiHeader",function(){return c("Header")}),a.directive("acfiContentTemplate",function(){return b("Content")}),a.directive("acfiContent",function(){return c("Content")}),a.directive("acfiNoResultsTemplate",function(){return b("NoResults")}),a.directive("acfiNoResults",function(){return c("NoResults")}),a.directive("acfiViewMoreTemplate",function(){return b("ViewMore")}),a.directive("acfiViewMore",function(){return c("ViewMore")}),a.controller("acfiSearchboxController",["$scope","$window","acfiIntervalInstance","acfiDataInstance",function(a,b,c,d){b.focus(),a.AcfiData=d.get(a.acId),a.AcfiInterval=c.get(a.acId),b.onblur=function(){a.AcfiInterval.inFocus=!1},b.onfocus=function(){a.AcfiInterval.inFocus=!0},a.$on("onInitInterval",function(b,c){c===a.acId&&a.AcfiData.init()}),a.$on("onPauseInterval",function(b,c,d){d===a.acId&&a.AcfiData.pause(c)}),a.$on("onContinueInterval",function(b,c){c===a.acId&&a.AcfiData.continueC()}),a.$on("onStopInterval",function(b,c){c===a.acId&&(a.AcfiData.string="",a.AcfiData.data_before=[])})}]),a.directive("acFancyInput",["$rootScope","acfiCaret","$timeout","acfiDataInstance",function(a,b,c,d){var e='<div data-ng-class="{ focus: $root.searchFieldIsFocus || AcfiData.display }"><div ng-transclude></div><div class="acfi-before" acfi-before></div><input tabindex="2" id="inputAnimation" class="anim-field" type="text" maxlength="70" spellcheck="false"';return e+=" data-ng-class=\"{'no-opacity': AcfiData.animating == false}\")",e+=' data-ng-style="AcfiData.font_style"',e+=' data-ng-model="AcfiData.string">',e+='<div data-ng-style="AcfiData.font_style" class="fancyInputFiller">',e+='<span data-ng-repeat="char in AcfiData.data_before track by $index" data-ng-class="{colored: char[0] == true}">{{char[1]}}</span>',e+='<b class="caret" data-ng-hide="$root.hideCaret">&#8203;</b>',e+='<span data-ng-repeat="char_2 in AcfiData.data_after track by $index">{{char_2}}</span>',e+="</div>",e+="<span acfi-after></span>",e+="</div>",{restrict:"A",template:e,replace:!0,transclude:!0,controller:"acfiSearchboxController",scope:{acAnimate:"=acAnimate",acId:"=acId"},link:function(e,f){var g=angular.element(f.children()[2]);e.filterTextTimeout={},e.acfiCaret=b,e.AcfiData=d.get(e.acId),g.bind("keyup select mouseup cut paste",function(a){13!==a.keyCode&&e.processBinding(a,this)}),e.$on("onEnterQuery",function(){f[0].blur()}),g.on("blur",function(){e.$apply(function(){e.AcfiData.decideToStart(e.acAnimate),e.AcfiData.searchFieldIsFocus=!1})}),g.on("focus",function(){e.$apply(function(){e.AcfiData.decideToStop(),e.AcfiData.searchFieldIsFocus=!0})}),g.bind("keydown",function(b){if(13===b.keyCode)a.$broadcast("onSubmitQuery",e.acId);else if(38===b.keyCode||40===b.keyCode){var c=1;38===b.keyCode&&(c=-1),a.$broadcast("onKeyUpAndDown",c,e.acId)}else e.$apply(function(){e.AcfiData.selected_index=1e4}),e.processBinding(b,this)}),e.processBinding=function(a,b){e.$apply(function(){var c=g.val().replace(/\s+/g," ").split("").reverse(),d=e.acfiCaret.setCaret(b,!0,a);e.AcfiData.processBinding(c,d,g.val())})},e.$watch(function(){return e.AcfiData.string},function(b){e.AcfiData.watching===!0&&(e.filterTextTimeout&&c.cancel(e.filterTextTimeout),e.filterTextTimeout=c(function(){e.AcfiData.checkFontThreshold(),a.$broadcast("onQuerySuggestions",b,e.acId)},140))})}}}]);var d=function(a){return{transclude:!0,restrict:"A",require:"^acFancyInput",link:function(b,c,d,e,f){c.remove(),e["renderAcfi"+a+"Template"]=f}}},e=function(a){return{restrict:"A",require:"^acFancyInput",link:function(b,c,d,e){void 0!==e["renderAcfi"+a+"Template"]&&e["renderAcfi"+a+"Template"](b,function(a){c.append(a)})}}};a.directive("acfiBeforeTemplate",function(){return d("Before")}),a.directive("acfiBefore",function(){return e("Before")}),a.directive("acfiAfterTemplate",function(){return d("After")}),a.directive("acfiAfter",function(){return e("After")}),a.factory("acfiCaret",function(){var a={};return a.direction=-1,a.lastOffset=0,a.charDir={lastDir:null,check:function(a){var b="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿Ⰰ-﬜﷾-﹯﻽-￿",c="֑-߿יִ-﷽ﹰ-ﻼ",d=new RegExp("^[^"+c+"]*["+b+"]"),e=new RegExp("^[^"+b+"]*["+c+"]"),f=e.test(a)?"rtl":d.test(a)?"ltr":"";return f&&(this.lastDir=f),f}},a.setDirection=function(b){var c=0;37===b.keyCode&&(c=-1),39===b.keyCode&&(c=1),"mousedown"===b.type&&(a.lastOffset=b.clientX),"mouseup"===b.type&&(c=b.clientX<a.lastOffset?-1:1),a.direction=c},a.setCaret=function(b,c,d){a.setDirection(d);var e=a.getCaretPosition(b);return"rtl"===a.charDir.lastDir&&(e=b.value.length-e),c===!0?e:e+a.direction},a.getCaretPosition=function(b){var c,d=a.direction||1;return(b.selectionStart||"0"===b.selectionStart)&&(c=-1===d?b.selectionStart:b.selectionEnd),c||0},a}),a.factory("acfiData",["$timeout","$rootScope","acfiIntervalInstance",function(a,b,c){var d=function(a){this.id=a.id,this.data_before=[],this.data_after=[],this.string="",this.tmp_str="",this.animating=!0,this.colored_text=!0,this.watching=!1,this.font_style={"font-size":"2.70em"},this.font_thresholds=[[2e3,1.75],[50,2.05],[45,2.3],[40,2.55],[35,2.7]],this.noResultDisplay=!1,this.suggestionLimit=2,this.suggestionDisplayLimit=6,this.selected_index=1e4,this.display=!1,this.lock_display=!1,this.suggestion_types=[{klass:"",contents:[],name:""}],this.actionTimeout={},this.init_string="",this.selected={},this.resizeAnimation=!1,this.searchFieldIsFocus=!1,this.acfiInterval=c.create(a.id)},e=function(a,b,c){this.init_string=a,this.init_array=a.split("").reverse(),this.pause_array=b.split("").reverse(),this.continue_array=c,this.acfiInterval.maxLoopIndex=c.length},f=function(){this.colored_text=!0,this.animating=!0,this.init_array=this.init_string.split("").reverse()},g=function(){for(var a={},b=0;b<this.font_thresholds.length;b++)this.data_before.length+this.data_after.length<this.font_thresholds[b][0]&&(a={"font-size":this.font_thresholds[b][1]+"em"});this.font_style=angular.copy(a)},h=function(){if(this.init_array.length>0){var a=this.init_array.pop();this.data_before.push(this.fillChar(a)),this.resizeAnimation===!0&&this.checkFontThreshold()}else this.acfiInterval.inFocus===!0&&this.acfiInterval.pauseAnimationInterval()},i=function(a){this.data_before=[],this.colored_text=!0;for(var b=this.pause_array.length-1;b>=0;b--)this.data_before.push(this.fillChar(this.pause_array[b]));this.colored_text=!1,this.tmp_str=this.continue_array[a].split("").reverse()},j=function(){if(this.tmp_str.length>0){var a=this.tmp_str.pop();this.data_before.push(this.fillChar(a)),this.resizeAnimation===!0&&this.checkFontThreshold()}else this.acfiInterval.pauseAnimationInterval()},k=function(a){return"+"===a?(this.colored_text=!1,[]):"-"===a?(this.colored_text=!0,[]):[this.colored_text,this.purifyChar(a)]},l=function(a){return" "===a?" ":a},m=function(a,b){this.selected_index+=b,this.selected_index<0?this.selected_index=this.displayedLength()-1:this.selected_index>this.displayedLength()-1&&(this.selected_index=0),this.selectContent()},n=function(){for(var a=0,b=0;b<this.suggestion_types.length;b++)a+=this.suggestion_types[b].contents.length;return a},o=function(a,b){this.deselectAll(),this.selectWithIndexes(a,b),this.updateSelectedData(this.suggestion_types[a].contents[b])},p=function(a,b){this.suggestion_types[a].contents[b].selected=!0,this.selected_index=this.flattenIndex(a,b),this.selected=this.suggestion_types[a].contents[b]},q=function(){this.deselectAll();var a=0;a:for(var b=0;b<this.suggestion_types.length;b++)for(var c=0;c<this.suggestion_types[b].contents.length;c++){if(a===this.selected_index){this.selectSuggestion(b,c);break a}a+=1}},r=function(a){var b=angular.copy(a);b.string=this.truncate(b.string,70),this.watching=!1,this.colored_text=!1,this.slug=b.slug,this.type=b.type,this.updateInput(b.string),this.checkFontThreshold()},s=function(a){this.string=a,this.data_before=[this.fillChar(a)],this.data_after=[]},t=function(a,b){for(var c=b,d=0;a>d;d++)c+=this.suggestion_types[d].contents.length;return c},u=function(){for(var a=0;a<this.suggestion_types.length;a++)for(var b=0;b<this.suggestion_types[a].contents.length;b++)this.suggestion_types[a].contents[b].selected=!1},v=function(a,b){return a.length>b?a.substr(0,b-4)+"...":a},w=function(){this.actionTimeout&&(a.cancel(this.actionTimeout),this.actionTimeout={}),this.animating===!0&&(this.animating=!1,this.acfiInterval.stopAnimationInterval())},x=function(c){void 0===c&&(c=!0);var d=this;b.hideCaret=!1,console.log(c),console.log(this.string),console.log(this.animating),this.animating===!1&&""===this.string&&c&&(this.actionTimeout=a(function(){d.reset(),b.$broadcast("onResetInterval",d.id),d.acfiInterval.startAnimationInterval()},150))},y=function(a,b,c){if(this.watching===!1)this.watching=!0;else{for(var d="",e=0;b>e;e++){var f=a.pop();void 0!==f&&(d+=f)}a=a.reverse(),this.data_after=[a.join("")],this.data_before=[[!1,d]],this.slug="",this.string=c}};return d.prototype={initText:e,reset:f,checkFontThreshold:g,init:h,pause:i,continueC:j,fillChar:k,purifyChar:l,onKeyUpAndDown:m,displayedLength:n,selectSuggestion:o,selectWithIndexes:p,selectContent:q,updateSelectedData:r,updateInput:s,flattenIndex:t,deselectAll:u,truncate:v,decideToStop:w,decideToStart:x,processBinding:y},d}]),a.factory("acfiDataInstance",["acfiData",function(a){var b={data:{}};return b.create=function(c){return void 0===b.data[c]?b.data[c]=new a({id:c}):console.log("Error: acfiData Instance already exists with the id: "+c),b.data[c]},b.get=function(c){return void 0===b.data[c]&&(b.data[c]=new a({id:c})),b.data[c]},b}]),a.factory("acfiInterval",["$q","$rootScope","$interval","$timeout",function(a,b,c,d){var e=function(a){this.id=a,this.intervalTime=90,this.pauseTimeoutTime=2e3,this.stopInterval=!1,this.initInterval=null,this.pauseTimeout=null,this.continueInterval=null,this.loopIndex=0,this.maxLoopIndex=6,this.miniTimeout=null,this.inFocus=!0,this.antiKonami=!1},f=function(){var a=this;this.antiKonami===!1&&(this.pauseTimeout=null,this.continueInterval=null,this.initInterval=c(function(){a.inFocus===!0&&b.$broadcast("onInitInterval",a.id)},this.intervalTime),this.antiKonami=!0)},g=function(){this.antiKonami=!1,this.loopIndex=0,this.safeCancel(this.initInterval),this.safeTimeoutCancel(this.pauseTimeout),this.safeTimeoutCancel(this.miniTimeout),this.safeCancel(this.continueInterval),this.initInterval=null,this.continueInterval=null,this.pauseTimeout=null,this.stopInterval=!0,b.$broadcast("onStopInterval",this.id)},h=function(){var a=this;this.pauseTimeout=null,this.miniTimeout=d(function(){a.inFocus===!0&&b.$broadcast("onSlowContinueInterval",a.id),a.continueInterval=c(function(){a.inFocus===!0&&b.$broadcast("onContinueInterval",a.id)},a.intervalTime)},120)},i=function(){var a=this;this.safeCancel(this.continueInterval),this.safeCancel(this.initInterval),this.initInterval=null,this.continueInterval=null,this.pauseTimeout=d(function(){a.inFocus===!0?(a.loopIndex+=1,a.loopIndex>=a.maxLoopIndex&&(a.loopIndex=0),b.$broadcast("onPauseInterval",a.loopIndex,a.id),a.continueAnimationInterval()):a.pauseAnimationInterval()},this.pauseTimeoutTime)},j=function(a){null!==a&&c.cancel(a)},k=function(a){null!==a&&d.cancel(a)};return e.prototype={startAnimationInterval:f,stopAnimationInterval:g,continueAnimationInterval:h,pauseAnimationInterval:i,safeCancel:j,safeTimeoutCancel:k},e}]),a.factory("acfiIntervalInstance",["acfiInterval",function(a){var b={data:{}};return b.create=function(c){return void 0===b.data[c]?b.data[c]=new a(c):console.log("Error: acfiInterval Instance already exists with the id: "+c),b.data[c]},b.get=function(a){return b.data[a]},b}])}(window,document);