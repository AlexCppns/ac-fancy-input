/*! ac-fancy-input 11-07-2014 */
!function(){var a=angular.module("ac-fancy-input",[]);a.run(["$templateCache","acfiTemplates",function(a,b){a.put("templates/acfi/suggestions.html",b.getSuggestions()),a.put("templates/acfi/fancy-input.html",b.getInput())}]),a.controller("acfiSuggestionsController",["acfiDataInstance","$scope","$q",function(a,b,c){b.AcfiData=a.init(b.acId),b.$on("onKeyUpAndDown",function(a,c,d){b.acId===d&&b.deferWatching().then(function(d){d&&(b.AcfiData.display=!0,b.AcfiData.onKeyUpAndDown(a,c))})}),b.$on("onCloseDisplay",function(a,c){b.acId===c&&b.$apply(function(){b.AcfiData.display=!1})}),b.deferWatching=function(){var a=c.defer();return b.AcfiData.watching=!1,a.resolve(b.AcfiData.watching===!1),a.promise}}]),a.directive("acFancyInputSuggestions",["$rootScope","$window","$templateCache",function(a,b,c){return{scope:{acfiViewMoreAction:"=acViewMoreAction",acSuggestionCount:"=?",acId:"=acFancyInputSuggestions"},replace:!0,template:c.get("templates/acfi/suggestions.html"),transclude:!0,controller:"acfiSuggestionsController",link:function(c,d,e){void 0===e.acSuggestionCount&&(c.acSuggestionCount=0),c.acfiQueryAction=function(){a.$broadcast("onSubmitQuery",c.acId)};var f=angular.element(b);d.bind("click",function(a){a.stopPropagation()}),f.bind("click",function(){a.$broadcast("onCloseDisplay",c.acId)})}}}]);var b=function(a){return{transclude:!0,restrict:"A",require:"^acFancyInputSuggestions",link:function(b,c,d,e,f){c.remove(),e["renderAcfi"+a+"Template"]=f}}},c=function(a){return{restrict:"A",require:"^acFancyInputSuggestions",link:function(b,c,d,e){void 0!==e["renderAcfi"+a+"Template"]&&e["renderAcfi"+a+"Template"](b,function(a){c.append(a)})}}};a.directive("acfiHeaderTemplate",function(){return b("Header")}),a.directive("acfiHeader",function(){return c("Header")}),a.directive("acfiContentTemplate",function(){return b("Content")}),a.directive("acfiContent",function(){return c("Content")}),a.directive("acfiNoResultsTemplate",function(){return b("NoResults")}),a.directive("acfiNoResults",function(){return c("NoResults")}),a.directive("acfiViewMoreTemplate",function(){return b("ViewMore")}),a.directive("acfiViewMore",function(){return c("ViewMore")}),a.controller("acfiSearchboxController",["$scope","$window","acfiIntervalInstance","acfiDataInstance",function(a,b,c,d){b.focus(),a.AcfiData=d.init(a.acId),a.AcfiInterval=c.init(a.acId),b.onblur=function(){a.AcfiInterval.inFocus=!1},b.onfocus=function(){a.AcfiInterval.inFocus=!0},a.$on("onInitInterval",function(b,c){c===a.acId&&a.AcfiData.init()}),a.$on("onPauseInterval",function(b,c,d){d===a.acId&&a.AcfiData.pause(c)}),a.$on("onContinueInterval",function(b,c){c===a.acId&&a.AcfiData.continueC()}),a.$on("onStopInterval",function(b,c){c===a.acId&&(a.AcfiData.string="",a.AcfiData.data_before=[])})}]),a.directive("acFancyInput",["$rootScope","acfiCaret","acfiDataInstance","$templateCache",function(a,b,c,d){return{restrict:"A",template:d.get("templates/acfi/fancy-input.html"),replace:!0,transclude:!0,controller:"acfiSearchboxController",scope:{acAnimate:"=?",acId:"=acFancyInput",acMaxLength:"=?",acOptions:"=?"},link:function(d,e){d.acMaxLength=d.acMaxLength||70,void 0===d.acAnimate&&(d.acAnimate=!0);var f=angular.element(e.children()[2]);d.filterTextTimeout={},d.acfiCaret=b,d.AcfiData=c.init(d.acId,d.acOptions),f.bind("keyup select mouseup cut paste",function(a){13!==a.keyCode&&d.processBinding(a,this)}),d.$on("onEnterQuery",function(){e[0].blur()}),f.on("blur",function(){d.$apply(function(){d.AcfiData.decideToStart(d.acAnimate),d.AcfiData.searchFieldIsFocus=!1})}),f.on("focus",function(){d.$apply(function(){d.AcfiData.decideToStop(),d.AcfiData.searchFieldIsFocus=!0})}),f.bind("keydown",function(b){if(13===b.keyCode)a.$broadcast("onSubmitQuery",d.acId);else if(38===b.keyCode||40===b.keyCode){var c=1;38===b.keyCode&&(c=-1),a.$broadcast("onKeyUpAndDown",c,d.acId)}else d.$apply(function(){d.AcfiData.selected_index=1e4}),d.processBinding(b,this)}),d.processBinding=function(a,b){d.$apply(function(){var c=f.val().replace(/\s+/g," ").split("").reverse(),e=d.acfiCaret.setCaret(b,!0,a);d.AcfiData.processBinding(c,e,f.val())})},d.$watch(function(){return d.AcfiData.string},function(a){d.AcfiData.handleWatch(a)})}}}]);var d=function(a){return{transclude:!0,restrict:"A",require:"^acFancyInput",link:function(b,c,d,e,f){c.remove(),e["renderAcfi"+a+"Template"]=f}}},e=function(a){return{restrict:"A",require:"^acFancyInput",link:function(b,c,d,e){void 0!==e["renderAcfi"+a+"Template"]&&e["renderAcfi"+a+"Template"](b,function(a){c.append(a)})}}};a.directive("acfiBeforeTemplate",function(){return d("Before")}),a.directive("acfiBefore",function(){return e("Before")}),a.directive("acfiAfterTemplate",function(){return d("After")}),a.directive("acfiAfter",function(){return e("After")}),a.factory("acfiCaret",function(){var a={};return a.direction=-1,a.lastOffset=0,a.charDir={lastDir:null,check:function(a){var b="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿Ⰰ-﬜﷾-﹯﻽-￿",c="֑-߿יִ-﷽ﹰ-ﻼ",d=new RegExp("^[^"+c+"]*["+b+"]"),e=new RegExp("^[^"+b+"]*["+c+"]"),f=e.test(a)?"rtl":d.test(a)?"ltr":"";return f&&(this.lastDir=f),f}},a.setDirection=function(b){var c=0;37===b.keyCode&&(c=-1),39===b.keyCode&&(c=1),"mousedown"===b.type&&(a.lastOffset=b.clientX),"mouseup"===b.type&&(c=b.clientX<a.lastOffset?-1:1),a.direction=c},a.setCaret=function(b,c,d){a.setDirection(d);var e=a.getCaretPosition(b);return"rtl"===a.charDir.lastDir&&(e=b.value.length-e),c===!0?e:e+a.direction},a.getCaretPosition=function(b){var c,d=a.direction||1;return(b.selectionStart||"0"===b.selectionStart)&&(c=-1===d?b.selectionStart:b.selectionEnd),c||0},a}),a.factory("acfiData",["$timeout","$rootScope","acfiIntervalInstance",function(a,b,c){var d=function(a,b){b=b||{},this.id=a,this.data_before=[],this.data_after=[],this.string="",this.tmp_str="",this.animating=!0,this.watching=!1,this.noResultDisplay=!1,this.selected_index=1e4,this.display=!1,this.actionTimeout={},this.filterTextTimeout={},this.selected={},this.searchFieldIsFocus=!1,this.defaults={font_style:{"font-size":"2.70em"},font_thresholds:[[2e3,1.75],[50,2.05],[45,2.3],[40,2.55],[35,2.7]],suggestion_types:[{klass:"",contents:[],name:""}],suggestionDisplayLimit:6,suggestionLimit:2,init_string:"",pause_string:"",continue_array:"",colored_text:!0,resizeAnimation:!1},this.setOpts(b),this.acfiInterval=c.create(a),this.initText(this.init_string,this.pause_string,this.continue_array)},e=function(a){this.colored_text=a.colored_text||this.defaults.colored_text,this.font_style=a.font_style||this.defaults.font_style,this.font_thresholds=a.font_thresholds||this.defaults.font_thresholds,this.suggestionLimit=a.suggestionLimit||this.defaults.suggestionLimit,this.suggestionDisplayLimit=a.suggestionDisplayLimit||this.defaults.suggestionDisplayLimit,this.suggestion_types=a.suggestion_types||this.defaults.suggestion_types,this.init_string=a.init_string||this.defaults.init_string,this.init_array=a.init_array||this.defaults.init_array,this.continue_array=a.continue_array||this.defaults.continue_array,this.pause_string=a.pause_string||this.defaults.pause_string,this.resizeAnimation=a.resizeAnimation||this.defaults.resizeAnimation},f=function(a,b,c){this.init_string=a,this.init_array=a.split("").reverse(),this.pause_array=b.split("").reverse(),this.continue_array=c,this.acfiInterval.maxLoopIndex=c.length},g=function(){this.colored_text=!0,this.animating=!0,this.init_array=this.init_string.split("").reverse()},h=function(){var a={},b=this.data_before.length+this.data_after.length;3>b&&(b=this.string.length);for(var c=0;c<this.font_thresholds.length;c++)b<this.font_thresholds[c][0]&&(a={"font-size":this.font_thresholds[c][1]+"em"});this.font_style=angular.copy(a)},i=function(){if(this.init_array.length>0){var a=this.init_array.pop();this.data_before.push(this.fillChar(a)),this.resizeAnimation===!0&&this.checkFontThreshold()}else this.acfiInterval.inFocus===!0&&this.acfiInterval.pauseAnimationInterval()},j=function(a){this.data_before=[],this.colored_text=!0;for(var b=this.pause_array.length-1;b>=0;b--)this.data_before.push(this.fillChar(this.pause_array[b]));this.colored_text=!1,this.tmp_str=this.continue_array[a].split("").reverse()},k=function(){if(this.tmp_str.length>0){var a=this.tmp_str.pop();this.data_before.push(this.fillChar(a)),this.resizeAnimation===!0&&this.checkFontThreshold()}else this.acfiInterval.pauseAnimationInterval()},l=function(a){return"+"===a?(this.colored_text=!1,[]):"-"===a?(this.colored_text=!0,[]):[this.colored_text,this.purifyChar(a)]},m=function(a){return" "===a?" ":a},n=function(a,b){this.selected_index+=b,this.selected_index<0?this.selected_index=this.displayedLength()-1:this.selected_index>this.displayedLength()-1&&(this.selected_index=0),this.selectContent()},o=function(){for(var a=0,b=0;b<this.suggestion_types.length;b++)a+=this.suggestion_types[b].contents.length;return a},p=function(){this.noResultDisplay=0===this.displayedLength(),this.display=!0},q=function(){this.noResultDisplay=!1,this.display=!1},r=function(a,b){this.deselectAll(),this.selectWithIndexes(a,b),this.updateSelectedData(this.suggestion_types[a].contents[b])},s=function(a,b){this.suggestion_types[a].contents[b].selected=!0,this.selected_index=this.flattenIndex(a,b),this.selected=this.suggestion_types[a].contents[b]},t=function(){this.deselectAll();var a=0;a:for(var b=0;b<this.suggestion_types.length;b++)for(var c=0;c<this.suggestion_types[b].contents.length;c++){if(a===this.selected_index){this.selectSuggestion(b,c);break a}a+=1}},u=function(a){var b=angular.copy(a);b.string=this.truncate(b.string,70),this.watching=!1,this.colored_text=!1,this.slug=b.slug,this.type=b.type,this.updateInput(b.string),this.checkFontThreshold()},v=function(a){this.string=a,this.data_before=[this.fillChar(a)],this.data_after=[]},w=function(a){this.updateInput(a),this.hide()},x=function(a,b){for(var c=b,d=0;a>d;d++)c+=this.suggestion_types[d].contents.length;return c},y=function(){for(var a=0;a<this.suggestion_types.length;a++)for(var b=0;b<this.suggestion_types[a].contents.length;b++)this.suggestion_types[a].contents[b].selected=!1},z=function(a,b){return a.length>b?a.substr(0,b-4)+"...":a},A=function(){this.actionTimeout&&(a.cancel(this.actionTimeout),this.actionTimeout={}),this.animating===!0&&(this.animating=!1,this.acfiInterval.stopAnimationInterval())},B=function(c){void 0===c&&(c=!0);var d=this;b.hideCaret=!1,this.animating===!1&&""===this.string&&c&&(this.actionTimeout=a(function(){d.reset(),b.$broadcast("onResetInterval",d.id),d.acfiInterval.startAnimationInterval()},150))},C=function(a,b,c){if(this.watching===!1)this.watching=!0;else{for(var d="",e=0;b>e;e++){var f=a.pop();void 0!==f&&(d+=f)}a=a.reverse(),this.data_after=[a.join("")],this.data_before=[[!1,d]],this.slug="",this.string=c}},D=function(c){var d=this;this.watching===!0&&(this.filterTextTimeout&&a.cancel(this.filterTextTimeout),this.filterTextTimeout=a(function(){d.checkFontThreshold(),b.$broadcast("onQuerySuggestions",c,d.id)},250))};return d.prototype={initText:f,reset:g,checkFontThreshold:h,init:i,pause:j,continueC:k,fillChar:l,purifyChar:m,onKeyUpAndDown:n,displayedLength:o,selectSuggestion:r,selectWithIndexes:s,selectContent:t,updateSelectedData:u,updateInput:v,setInput:w,flattenIndex:x,deselectAll:y,truncate:z,decideToStop:A,decideToStart:B,processBinding:C,handleWatch:D,setOpts:e,show:p,hide:q},d}]),a.factory("acfiDataInstance",["acfiData",function(a){var b={data:{}};return b.create=function(c,d){return b.data[c]=new a(c,d),b.data[c]},b.init=function(a,c){return void 0===b.data[a]?b.create(a,c):void 0!==c&&c!=={}&&b.data[a].setOpts(c),b.data[a]},b}]),a.factory("acfiInterval",["$rootScope","$interval","$timeout",function(a,b,c){var d=function(a){this.id=a,this.intervalTime=90,this.pauseTimeoutTime=2e3,this.initInterval=null,this.pauseTimeout=null,this.continueInterval=null,this.loopIndex=0,this.maxLoopIndex=6,this.miniTimeout=null,this.inFocus=!0,this.antiKonami=!1},e=function(){var c=this;this.antiKonami===!1&&(this.pauseTimeout=null,this.continueInterval=null,this.initInterval=b(function(){c.inFocus===!0&&a.$broadcast("onInitInterval",c.id)},this.intervalTime),this.antiKonami=!0)},f=function(){this.antiKonami=!1,this.loopIndex=0,this.safeCancel(this.initInterval),this.safeTimeoutCancel(this.pauseTimeout),this.safeTimeoutCancel(this.miniTimeout),this.safeCancel(this.continueInterval),this.initInterval=null,this.continueInterval=null,this.pauseTimeout=null,a.$broadcast("onStopInterval",this.id)},g=function(){var d=this;this.pauseTimeout=null,this.miniTimeout=c(function(){d.inFocus===!0&&a.$broadcast("onSlowContinueInterval",d.id),d.continueInterval=b(function(){d.inFocus===!0&&a.$broadcast("onContinueInterval",d.id)},d.intervalTime)},120)},h=function(){var b=this;this.safeCancel(this.continueInterval),this.safeCancel(this.initInterval),this.initInterval=null,this.continueInterval=null,this.pauseTimeout=c(function(){b.inFocus===!0?(b.loopIndex+=1,b.loopIndex>=b.maxLoopIndex&&(b.loopIndex=0),a.$broadcast("onPauseInterval",b.loopIndex,b.id),b.continueAnimationInterval()):b.pauseAnimationInterval()},this.pauseTimeoutTime)},i=function(a){null!==a&&b.cancel(a)},j=function(a){null!==a&&c.cancel(a)};return d.prototype={startAnimationInterval:e,stopAnimationInterval:f,continueAnimationInterval:g,pauseAnimationInterval:h,safeCancel:i,safeTimeoutCancel:j},d}]),a.factory("acfiIntervalInstance",["acfiInterval",function(a){var b={data:{}};return b.create=function(c){return b.data[c]=new a(c),b.data[c]},b.init=function(a,c){return void 0===b.data[a]&&b.create(a),c===!0&&b.data[a].startAnimationInterval(),b.data[a]},b}]),a.factory("acfiTemplates",[function(){var a={};return a.getSuggestions=function(){var a="<div data-ng-transclude></div><span data-acfi-header></span>",b='<div class="type-row clearfix" data-ng-class="suggestion_type.klass" data-ng-class-even="\'even\'" data-ng-class-odd="\'odd\'" data-ng-repeat="suggestion_type in AcfiData.suggestion_types"><div class="type-name-wrapper" data-ng-show="suggestion_type.contents.length > 0"><div class="type-name small semi-bold">{{suggestion_type.name}}</div></div><div class="type-content" data-ng-show="suggestion_type.contents.length > 0"><ul><li data-ng-repeat="content in suggestion_type.contents" data-ng-class="{ selected: content.selected}" data-ng-mouseover="AcfiData.selectSuggestion($parent.$index, $index)" data-ng-click="AcfiData.selectSuggestion($parent.$index, $index); acfiQueryAction()"><div class="row-wrapper light clearfix" data-acfi-content></div></li></ul></div></div>',c='<div class="view-more"><a data-ng-show="AcfiData.noResultDisplay == false && acSuggestionCount > AcfiData.suggestionDisplayLimit" data-ng-click="acfiViewMoreAction($event)"><div data-acfi-view-more></div></a><a data-ng-show="AcfiData.noResultDisplay == true" class="no-results"><div data-acfi-no-results></div></a></div>',d='<div class="input-suggestion-container"><div id="acfi-suggestions{{acId}}" class="input-suggestion" data-ng-show="AcfiData.display == true" data-acfi-reset-display>';return d+=a+b+c,d+="</div></div>"},a.getInput=function(){var a="<div data-ng-transclude></div>",b='<div class="acfi-before" data-acfi-before></div>',c="<span data-acfi-after></span>",d='<input tabindex="{{acId}}" id="acfi{{acId}}" class="anim-field" type="text" maxlength="{{acMaxLength}}" spellcheck="false" data-ng-class="{\'no-opacity\': AcfiData.animating == false}" data-ng-style="AcfiData.font_style" data-ng-model="AcfiData.string">',e='<div data-ng-style="AcfiData.font_style" class="fancyInputFiller"><span data-ng-repeat="char in AcfiData.data_before track by $index" data-ng-class="{colored: char[0] == true}">{{char[1]}}</span><b class="caret" data-ng-hide="$root.hideCaret">&#8203;</b><span data-ng-repeat="char_2 in AcfiData.data_after track by $index">{{char_2}}</span></div>',f='<div data-ng-class="{ focus: AcfiData.searchFieldIsFocus || AcfiData.display }">';return f+=a+b+d+e+c,f+="</div>"},a}])}(window,document);