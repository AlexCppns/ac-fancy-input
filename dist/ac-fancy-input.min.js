/*! ac-fancy-input 30-06-2014 */
!function(){var a=angular.module("ac-fancy-input",[]);a.controller("acfiSuggestionsController",["acfi-searchBoxData","$scope","$q",function(a,b,c){b.SearchBoxData=a,b.$on("onKeyUpAndDown",function(a,c){b.deferWatching().then(function(d){d&&(b.SearchBoxData.display=!0,b.SearchBoxData.onKeyUpAndDown(a,c))})}),b.$on("onCloseDisplay",function(){b.$apply(function(){b.SearchBoxData.display=!1})}),b.deferWatching=function(){var a=c.defer();return b.SearchBoxData.watching=!1,a.resolve(b.SearchBoxData.watching===!1),a.promise}}]),a.directive("acFancyInputSuggestions",[function(){var a="<div ng-transclude></div><span acfi-header></span>",b='<div class="type-row clearfix" data-ng-class="suggestion_type.klass" data-ng-class-even="\'even\'" data-ng-class-odd="\'odd\'" data-ng-repeat="suggestion_type in SearchBoxData.suggestion_types"><div class="type-name-wrapper" data-ng-show="suggestion_type.contents.length > 0"><div class="type-name small semi-bold">{{suggestion_type.name}}</div></div><div class="type-content" data-ng-show="suggestion_type.contents.length > 0"><ul><li data-ng-repeat="content in suggestion_type.contents" data-ng-class="{ selected: content.selected}" data-ng-mouseover="SearchBoxData.selectSuggestion($parent.$index, $index)" data-ng-click="SearchBoxData.selectSuggestion($parent.$index, $index); acfiQueryAction()"><div class="row-wrapper light clearfix" acfi-content></div></li></ul></div></div>',c='<div class="view-more"><a data-ng-show="SearchBoxData.noResultDisplay == false && SearchBoxData.raw_suggestions.length > SearchBoxData.suggestionDisplayLimit" data-ng-click="acfiViewMoreAction($event)"><div acfi-no-results></div></a><a data-ng-show="SearchBoxData.noResultDisplay == true" class="no-results"><div acfi-view-more></div></a></div>',d='<div id="input-suggestion-box" class="input-suggestion" data-ng-show="SearchBoxData.display == true" acfi-reset-display>';return d+=a+b+c,d+="</div>",{scope:{acfiQueryAction:"=acQueryAction",acfiViewMoreAction:"=acViewMoreAction"},template:d,transclude:!0,controller:"acfiSuggestionsController"}}]);var b=function(a){return{transclude:!0,restrict:"A",require:"^acFancyInputSuggestions",link:function(b,c,d,e,f){c.remove(),e["renderAcfi"+a+"Template"]=f}}},c=function(a){return{restrict:"A",require:"^acFancyInputSuggestions",link:function(b,c,d,e){e["renderAcfi"+a+"Template"](b,function(a){c.append(a)})}}};a.directive("acfiHeaderTemplate",function(){return b("Header")}),a.directive("acfiHeader",function(){return c("Header")}),a.directive("acfiContentTemplate",function(){return b("Content")}),a.directive("acfiContent",function(){return c("Content")}),a.directive("acfiNoResultsTemplate",function(){return b("NoResults")}),a.directive("acfiNoResults",function(){return c("NoResults")}),a.directive("acfiViewMoreTemplate",function(){return b("ViewMore")}),a.directive("acfiViewMore",function(){return c("ViewMore")}),a.controller("acfi-SearchboxController",["$rootScope","$scope","$window","acfi-intervalManager","acfi-searchBoxData",function(a,b,c,d,e){c.focus(),b.searchBoxData=e,b.intervalManager=d,c.onblur=function(){b.intervalManager.inFocus=!1},c.onfocus=function(){b.intervalManager.inFocus=!0},b.$on("onInitInterval",function(){b.searchBoxData.init(b.intervalManager)}),b.$on("onPauseInterval",function(a,c){b.searchBoxData.pause(c)}),b.$on("onContinueInterval",function(){b.searchBoxData.continueC(b.intervalManager)}),b.$on("onStopInterval",function(){b.searchBoxData.string="",b.searchBoxData.data_before=[]})}]),a.directive("acFancyInput",["$rootScope","acfi-writerManager","$timeout","acfi-searchBoxData",function(a,b,c,d){var e='<div><input tabindex="2" id="inputAnimation" class="anim-field" type="text" maxlength="70" spellcheck="false"';return e+=" data-ng-class=\"{'no-opacity': SearchBoxData.animating == false}\")",e+=' data-ng-style="SearchBoxData.font_style"',e+=' data-ng-model="SearchBoxData.string">',e+='<div data-ng-style="SearchBoxData.font_style" class="fancyInputFiller">',e+='<span data-ng-repeat="char in SearchBoxData.data_before track by $index" data-ng-class="{colored: char[0] == true}">{{char[1]}}</span>',e+='<b class="caret" data-ng-hide="$root.hideCaret">&#8203;</b>',e+='<span data-ng-repeat="char_2 in SearchBoxData.data_after track by $index">{{char_2}}</span>',e+="</div></div>",{restrict:"A",template:e,replace:!0,link:function(e,f){var g=f.children(1);e.filterTextTimeout={},e.writerManager=b,e.searchBoxData=d,g.bind("keyup select mouseup cut paste",function(a){13!==a.keyCode&&e.processBinding(a,this)}),e.$on("onEnterQuery",function(){f[0].blur()}),g.on("blur",function(){e.$apply(function(){var b=a.results===!1;e.searchBoxData.decideToStart(b),a.searchFieldIsFocus=!1})}),g.on("focus",function(){e.$apply(function(){e.SearchBoxData.decideToStop(),a.searchFieldIsFocus=!0})}),g.bind("keydown",function(b){if(13===b.keyCode)a.$broadcast("onSubmitQuery");else if(38===b.keyCode||40===b.keyCode){var c=1;38===b.keyCode&&(c=-1),a.$broadcast("onKeyUpAndDown",c)}else e.$apply(function(){e.searchBoxData.selected_index=1e4}),e.processBinding(b,this)}),e.processBinding=function(a,b){e.$apply(function(){var c=g.val().replace(/\s+/g," ").split("").reverse(),d=e.writerManager.setCaret(b,!0,a);e.searchBoxData.processBinding(c,d,g.val())})},e.$watch(function(){return e.searchBoxData.string},function(b){e.searchBoxData.watching===!0&&(e.filterTextTimeout&&c.cancel(e.filterTextTimeout),e.filterTextTimeout=c(function(){e.searchBoxData.checkFontThreshold(),a.$broadcast("onQuerySuggestions",b)},140))})}}}]),a.directive("acfiResetDisplay",["$rootScope","$window",function(a,b){return{link:function(c,d){var e=angular.element(b);d.bind("click",function(a){a.stopPropagation()}),e.bind("click",function(){a.$broadcast("onCloseDisplay")})}}}]),a.factory("acfi-searchBoxData",["$timeout","$rootScope","acfi-intervalManager",function(a,b,c){var d={};return d.data_before=[],d.data_after=[],d.string="",d.tmp_str="",d.animating=!0,d.colored_text=!0,d.watching=!1,d.raw_suggestions=[],d.font_style={"font-size":"2.75em"},d.font_thresholds=[[2e3,1.75],[50,2.05],[45,2.3],[40,2.55],[35,2.75]],d.noResultDisplay=!1,d.suggestionLimit=2,d.suggestionDisplayLimit=6,d.selected_index=1e4,d.display=!1,d.lock_display=!1,d.suggestion_types=[{klass:"",contents:[],name:""}],d.actionTimeout={},d.init_string="",d.initText=function(a,b,e){d.init_string=a,d.init_array=a.split("").reverse(),d.pause_array=b.split("").reverse(),d.continue_array=e,c.maxLoopIndex=e.length},d.reset=function(){d.colored_text=!0,d.animating=!0,d.init_array=d.init_string.split("").reverse()},d.checkFontThreshold=function(){for(var a={},b=0;b<d.font_thresholds.length;b++)d.string.length<d.font_thresholds[b][0]&&(a={"font-size":d.font_thresholds[b][1]+"em"});d.font_style=angular.copy(a)},d.init=function(a){if(d.init_array.length>0){var b=d.init_array.pop();d.data_before.push(d.fillChar(b))}else a.inFocus===!0&&a.pauseAnimationInterval()},d.pause=function(a){d.data_before=[],d.colored_text=!0;for(var b=d.pause_array.length-1;b>=0;b--)d.data_before.push(d.fillChar(d.pause_array[b]));d.colored_text=!1,d.tmp_str=d.continue_array[a].split("").reverse()},d.continueC=function(a){if(d.tmp_str.length>0){var b=d.tmp_str.pop();d.data_before.push(d.fillChar(b))}else a.pauseAnimationInterval()},d.fillChar=function(a){return"+"===a?(d.colored_text=!1,[]):"-"===a?(d.colored_text=!0,[]):[d.colored_text,d.purifyChar(a)]},d.purifyChar=function(a){return" "===a?" ":a},d.onKeyUpAndDown=function(a,b){d.selected_index+=b,d.selected_index<0?d.selected_index=d.displayedLength()-1:d.selected_index>d.displayedLength()-1&&(d.selected_index=0),d.selectContent()},d.displayedLength=function(){for(var a=0,b=0;b<d.suggestion_types.length;b++)a+=d.suggestion_types[b].contents.length;return a},d.selectSuggestion=function(a,b){d.deselectAll(),d.selectWithIndexes(a,b),d.updateSelectedData(d.suggestion_types[a].contents[b])},d.selectWithIndexes=function(a,b){d.suggestion_types[a].contents[b].selected=!0,d.selected_index=d.flattenIndex(a,b)},d.selectContent=function(){d.deselectAll();var a=0;a:for(var b=0;b<d.suggestion_types.length;b++)for(var c=0;c<d.suggestion_types[b].contents.length;c++){if(a===d.selected_index){d.selectSuggestion(b,c);break a}a+=1}},d.updateSelectedData=function(a){var b=angular.copy(a);b.string=d.truncate(b.string,70),d.watching=!1,d.colored_text=!1,d.string=b.string,d.slug=b.slug,d.type=b.type,d.data_before=[d.fillChar(b.string)],d.data_after=[],d.checkFontThreshold()},d.flattenIndex=function(a,b){for(var c=b,e=0;a>e;e++)c+=d.suggestion_types[e].contents.length;return c},d.deselectAll=function(){d.slug="";for(var a=0;a<d.suggestion_types.length;a++)for(var b=0;b<d.suggestion_types[a].contents.length;b++)d.suggestion_types[a].contents[b].selected=!1},d.truncate=function(a,b){return a.length>b?a.substr(0,b-4)+"...":a},d.decideToStop=function(){d.actionTimeout&&(a.cancel(d.actionTimeout),d.actionTimeout={}),d.animating===!0&&(d.animating=!1,c.stopAnimationInterval())},d.decideToStart=function(e){void 0===e&&(e=!0),b.hideCaret=!1,d.animating===!1&&""===d.string&&e&&(d.actionTimeout=a(function(){d.reset(),b.$broadcast("onResetInterval"),c.startAnimationInterval()},150))},d.processBinding=function(a,b,c){if(d.watching===!1)d.watching=!0;else{for(var e="",f=0;b>f;f++){var g=a.pop();void 0!==g&&(e+=g)}a=a.reverse(),d.data_after=[a.join("")],d.data_before=[[!1,e]],d.slug="",d.string=c}},d}]),a.factory("acfi-intervalManager",["$q","$rootScope","$interval","$timeout",function(a,b,c,d){var e={};return e.intervalTime=90,e.pauseTimeoutTime=2e3,e.stopInterval=!1,e.initInterval=null,e.pauseTimeout=null,e.continueInterval=null,e.loopIndex=0,e.maxLoopIndex=6,e.miniTimeout=null,e.inFocus=!0,e.antiKonami=!1,e.startAnimationInterval=function(){e.antiKonami===!1&&(e.pauseTimeout=null,e.continueInterval=null,e.initInterval=c(function(){e.inFocus===!0&&b.$broadcast("onInitInterval")},e.intervalTime),e.antiKonami=!0)},e.stopAnimationInterval=function(){e.antiKonami=!1,e.loopIndex=0,e.safeCancel(e.initInterval),e.safeTimeoutCancel(e.pauseTimeout),e.safeTimeoutCancel(e.miniTimeout),e.safeCancel(e.continueInterval),e.initInterval=null,e.continueInterval=null,e.pauseTimeout=null,e.stopInterval=!0,b.$broadcast("onStopInterval")},e.continueAnimationInterval=function(){e.pauseTimeout=null,e.miniTimeout=d(function(){e.inFocus===!0&&b.$broadcast("onSlowContinueInterval"),e.continueInterval=c(function(){e.inFocus===!0&&b.$broadcast("onContinueInterval")},e.intervalTime)},120)},e.pauseAnimationInterval=function(){e.safeCancel(e.continueInterval),e.safeCancel(e.initInterval),e.initInterval=null,e.continueInterval=null,e.pauseTimeout=d(function(){e.inFocus===!0?(e.loopIndex+=1,e.loopIndex>=e.maxLoopIndex&&(e.loopIndex=0),b.$broadcast("onPauseInterval",e.loopIndex),e.continueAnimationInterval()):e.pauseAnimationInterval()},e.pauseTimeoutTime)},e.safeCancel=function(a){null!==a&&c.cancel(a)},e.safeTimeoutCancel=function(a){null!==a&&d.cancel(a)},e}]),a.factory("acfi-writerManager",function(){var a={};return a.direction=-1,a.lastOffset=0,a.charDir={lastDir:null,check:function(a){var b="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿Ⰰ-﬜﷾-﹯﻽-￿",c="֑-߿יִ-﷽ﹰ-ﻼ",d=new RegExp("^[^"+c+"]*["+b+"]"),e=new RegExp("^[^"+b+"]*["+c+"]"),f=e.test(a)?"rtl":d.test(a)?"ltr":"";return f&&(this.lastDir=f),f}},a.setDirection=function(b){var c=0;37===b.keyCode&&(c=-1),39===b.keyCode&&(c=1),"mousedown"===b.type&&(a.lastOffset=b.clientX),"mouseup"===b.type&&(c=b.clientX<a.lastOffset?-1:1),a.direction=c},a.setCaret=function(b,c,d){a.setDirection(d);var e=a.getCaretPosition(b);return"rtl"===a.charDir.lastDir&&(e=b.value.length-e),c===!0?e:e+a.direction},a.getCaretPosition=function(b){var c,d=a.direction||1;return(b.selectionStart||"0"===b.selectionStart)&&(c=-1===d?b.selectionStart:b.selectionEnd),c||0},a})}(window,document);